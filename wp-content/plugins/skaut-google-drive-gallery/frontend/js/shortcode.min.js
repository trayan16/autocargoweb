jQuery(document).ready(function(g){"use strict";function i(t){return t.error!==undefined}var a=(t.prototype.get=function(){var t=new RegExp("[?&]sgdg-"+this.name+"-"+this.hash+"=(([^&#]*)|&|#|$)").exec(document.location.search);return t&&t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):""},t.prototype.remove=function(){var t=window.location.search,e=new RegExp("\\?sgdg-"+this.name+"-"+this.hash+"=[^&]*"),i=new RegExp("&sgdg-"+this.name+"-"+this.hash+"=[^&]*");return t=t&&(t=t.replace(e,"?")).replace(i,""),window.location.pathname+t},t.prototype.add=function(t){var e=window.location.search,i="sgdg-"+this.name+"-"+this.hash+"="+t,a="?"+i,o=new RegExp("([?&])sgdg-"+this.name+"-"+this.hash+"=[^&]*");return t?(e&&(a=null!==o.exec(e)?e.replace(o,"$1"+i):e+"&"+i),window.location.pathname+a):this.remove()},t);function t(t,e){this.hash=t,this.name=e}var e=require("justified-layout"),o=(r.prototype.onLightboxNavigation=function(t){var e=g(t).data("sgdg-page"),i=g(t).parent().children().length;history.replaceState(history.state,"",this.pageQueryParameter.add(e)),"true"===sgdgShortcodeLocalize.page_autoload&&this.hasMore&&g(t).index()>=Math.min(i-2,Math.floor(.9*i))&&this.add()},r.prototype.onLightboxQuit=function(){history.replaceState(history.state,"",this.pageQueryParameter.remove())},r.prototype.reflow=function(){var o=this,r=[],n=[];this.container.find(".sgdg-gallery").children().each(function(t,e){g(e).css("display","inline-block");var i=e.firstChild,a=i.naturalWidth/i.naturalHeight;if(0<g(e).find("svg").length){var o=g(e).find("svg")[0].getBBox();a=o.width/o.height}g(e).hasClass("sgdg-grid-square")&&(a=1),isNaN(a)?r[t]=!1:(r[t]=!0,n.push(a)),g(e).css("position","absolute")}),0<n.length&&this.container.find(".sgdg-loading").remove();var s=e(n,{containerWidth:this.container.find(".sgdg-gallery").width(),containerPadding:{top:10,left:0,right:0,bottom:0},boxSpacing:parseInt(sgdgShortcodeLocalize.grid_spacing),targetRowHeight:parseInt(sgdgShortcodeLocalize.grid_height),targetRowHeightTolerance:.15,edgeCaseMinRowHeight:0}),d=0;this.container.find(".sgdg-gallery").children().each(function(t,e){if(r[t]){var i=s.boxes[d],a=o.container.find(".sgdg-gallery").position();g(e).css("top",i.top+a.top),g(e).css("left",i.left+a.left),g(e).width(i.width),g(e).height(i.height),d++}else g(e).css("display","none")}),this.container.find(".sgdg-gallery").height(s.containerHeight)},r.prototype.reflowTimer=function(){var t=this;n.reflowAll(),this.loading&&setTimeout(function(){t.reflowTimer()},250)},r.prototype.init=function(){var t=this.pathQueryParameter.get();this.path!==t&&(this.path=t,this.get())},r.prototype.get=function(){var e=this;this.path=this.pathQueryParameter.get(),this.lastPage=parseInt(this.pageQueryParameter.get())||1,this.lightbox=g().imageLightbox({allowedTypes:"",animationSpeed:parseInt(sgdgShortcodeLocalize.preview_speed,10),activity:"true"===sgdgShortcodeLocalize.preview_activity,arrows:"true"===sgdgShortcodeLocalize.preview_arrows,button:"true"===sgdgShortcodeLocalize.preview_closebutton,fullscreen:!0,history:!0,overlay:!0,caption:"true"===sgdgShortcodeLocalize.preview_captions,quitOnEnd:"true"===sgdgShortcodeLocalize.preview_quitOnEnd}),this.container.find(".sgdg-gallery").replaceWith('<div class="sgdg-loading"><div></div></div>'),this.container.find(".sgdg-more-button").remove(),n.reflowAll(),g.get(sgdgShortcodeLocalize.ajax_url,{action:"gallery",hash:this.hash,path:this.path,page:this.lastPage},function(t){i(t)?e.container.html(t.error):e.getSuccess(t)})},r.prototype.getSuccess=function(t){var i=this,a=((t.directories?t.directories.length:0)+(t.images?t.images.length:0)+(t.videos?t.videos.length:0))/this.lastPage,o="",r=1,n=a;(t.path&&0<t.path.length||0<t.directories.length)&&(o+=this.renderBreadcrumbs(t.path)),0<t.directories.length||0<t.images.length||0<t.videos.length?(o+='<div class="sgdg-loading"><div></div></div><div class="sgdg-gallery">',t.directories&&g.each(t.directories,function(t,e){o+=i.renderDirectory(e),0==--n&&(n=a,r++)}),t.images&&g.each(t.images,function(t,e){o+=i.renderImage(r,e),0==--n&&(n=a,r++)}),t.videos&&g.each(t.videos,function(t,e){""!==document.createElement("video").canPlayType(e.mimeType)&&(o+=i.renderVideo(r,e)),0==--n&&(n=a,r++)}),o+="</div>",t.more&&(o+=this.renderMoreButton())):o+='<div class="sgdg-gallery">'+sgdgShortcodeLocalize.empty_gallery+"</div>",this.container.html(o),this.hasMore=t.more,this.postLoad(),this.lightbox.openHistory()},r.prototype.add=function(){var e=this;this.lastPage+=1,this.container.find(".sgdg-gallery").after('<div class="sgdg-loading"><div></div></div>'),this.container.find(".sgdg-more-button").remove(),g.get(sgdgShortcodeLocalize.ajax_url,{action:"page",hash:this.hash,path:this.pathQueryParameter.get(),page:this.lastPage},function(t){if(i(t))return e.container.find(".sgdg-loading").replaceWith(t.error),void e.container.find(".sgdg-more-button").remove();e.addSuccess(t)})},r.prototype.addSuccess=function(t){var i=this,a="";g.each(t.directories,function(t,e){a+=i.renderDirectory(e)}),g.each(t.images,function(t,e){a+=i.renderImage(i.lastPage,e)}),g.each(t.videos,function(t,e){a+=i.renderVideo(i.lastPage,e)}),this.container.find(".sgdg-gallery").append(a),this.hasMore=t.more,t.more&&this.container.append(this.renderMoreButton()),this.container.find(".sgdg-loading").remove(),this.postLoad()},r.prototype.postLoad=function(){var i=this;this.container.find("a[data-sgdg-path]").off("click").click(function(t){return history.pushState({},"",i.pathQueryParameter.add(g(t.currentTarget).data("sgdgPath"))),i.get(),!1}),this.container.find(".sgdg-more-button").click(function(){return i.add(),!1}),this.loading=!0,this.container.find(".sgdg-gallery").imagesLoaded({background:!0},function(){i.loading=!1,n.reflowAll()}),this.reflowTimer(),this.lightbox.addToImageLightbox(this.container.find("a[data-imagelightbox]")),"true"===sgdgShortcodeLocalize.page_autoload&&g(window).off("scroll").scroll(function(t){var e=g(".sgdg-more-button");undefined!==e.offset()&&g(t.currentTarget).scrollTop()+g(window).height()>e.offset().top+e.outerHeight()&&!i.loading&&i.add()})},r.prototype.renderBreadcrumbs=function(t){var i=this,a='<div><a data-sgdg-path="" href="'+this.pathQueryParameter.remove()+'">'+sgdgShortcodeLocalize.breadcrumbs_top+"</a>",o="";return g.each(t,function(t,e){o+=e.id,a+=' ><a data-sgdg-path="'+o+'" href="'+i.pathQueryParameter.add(o)+'">'+e.name+"</a>",o+="/"}),a+="</div>"},r.prototype.renderDirectory=function(t){var e=this.pathQueryParameter.get(),i='<a class="sgdg-grid-a sgdg-grid-square" data-sgdg-path="'+(e=(e?e+"/":"")+t.id)+'" href="'+this.pathQueryParameter.add(e)+'"';if(t.thumbnail?i+=" style=\"background-image: url('"+t.thumbnail+"');\">":i+='><svg class="sgdg-dir-icon" x="0px" y="0px" focusable="false" viewBox="0 0 24 24" fill="#8f8f8f"><path d="M10 4H4c-1.1 0-2 .9-2 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"></path></svg>',i+='<div class="sgdg-dir-overlay"><div class="sgdg-dir-name">'+t.name+"</div>",t.dircount&&(i+='<span class="sgdg-count-icon dashicons dashicons-category"></span> '+t.dircount+(1e3===t.dircount?"+":"")),t.imagecount){var a="";t.dircount&&(a=" sgdg-count-icon-indent"),i+='<span class="sgdg-count-icon dashicons dashicons-format-image'+a+'"></span> '+t.imagecount+(1e3===t.imagecount?"+":"")}return t.videocount&&(a="",(t.dircount||t.imagecount)&&(a=" sgdg-count-icon-indent"),i+='<span class="sgdg-count-icon dashicons dashicons-video-alt3'+a+'"></span> '+t.videocount+(1e3===t.videocount?"+":"")),i+="</div></a>"},r.prototype.renderImage=function(t,e){return'<a class="sgdg-grid-a" data-imagelightbox="'+this.shortHash+'" data-ilb2-id="'+e.id+'" data-ilb2-caption="'+e.description+'" data-sgdg-page="'+t+'" href="'+e.image+'"><img class="sgdg-grid-img" src="'+e.thumbnail+'"></a>'},r.prototype.renderVideo=function(t,e){return'<a class="sgdg-grid-a" data-imagelightbox="'+this.shortHash+'" data-ilb2-id="'+e.id+'" data-sgdg-page="'+t+'" data-ilb2-video=\'{ "controls": "controls", "autoplay": "autoplay", "sources": [ { "src": "'+e.src+'", "type": "'+e.mimeType+'" } ] }\'><img class="sgdg-grid-img" src="'+e.thumbnail+'"></a>'},r.prototype.renderMoreButton=function(){return'<div class="sgdg-more-button"><div>'+sgdgShortcodeLocalize.load_more+"</div></div>"},r);function r(t,e){var i=this;this.lightbox=g(),this.hasMore=!1,this.path="",this.lastPage=1,this.loading=!1,this.container=g(t),this.hash=e,this.shortHash=e.substr(0,8),this.pageQueryParameter=new a(this.shortHash,"page"),this.pathQueryParameter=new a(this.shortHash,"path"),this.path=this.pathQueryParameter.get(),this.get(),g(window).on("popstate",function(){return i.init()}),g(window).resize(function(){return i.reflow()})}var n={shortcodes:{},init:function(){var a=this;g(".sgdg-gallery-container").each(function(t,e){var i=g(e).data("sgdgHash");i&&(a.shortcodes[i.substr(0,8)]=new o(e,i))}),g(document).on("start.ilb2 next.ilb2 previous.ilb2",function(t,e){return a.onLightboxNavigation(e)}),g(document).on("quit.ilb2",function(){return a.onLightboxQuit()})},reflowAll:function(){g.each(this.shortcodes,function(t,e){e.reflow()})},onLightboxNavigation:function(t){var e=g(t).data("imagelightbox");this.shortcodes[e].onLightboxNavigation(t)},onLightboxQuit:function(){g.each(this.shortcodes,function(t,e){e.onLightboxQuit()})}};n.init()});